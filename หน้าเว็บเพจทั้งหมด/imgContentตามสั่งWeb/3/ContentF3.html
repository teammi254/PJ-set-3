<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ร้านขนมจีนเส้นสดแม่ลำพึง</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <link rel="stylesheet" href="CFPage.css"> 
</head>
<body>

    <nav class="shadow-sm sticky top-0 z-50" style="background-color: #e2d6b0;">
    <div class="container mx-auto px-4 h-14 flex items-center justify-between">
        <div class="flex items-center gap-4">
            <div class="text-2xl font-bold italic tracking-tighter">
                <span class="wongnai-blue">แนะนำ</span><span class="wongnai-orange">ใกล้ฉัน</span>
            </div>
        </div>

        <div class="flex items-center gap-3 text-sm text-gray-700 font-medium">
            <i class="fas fa-user-circle text-xl text-gray-600"></i>
            <span>เขียนขึ้นโดย mt.term</span>
        </div>
    </div>
</nav>

    <div class="container mx-auto px-4 py-4 max-w-6xl">
        
        <div class="grid grid-cols-4 gap-1 h-64 mb-4 rounded-lg overflow-hidden">
        <div class="col-span-2 bg-gray-200 relative">
            <img src="imgallinweb/ตำปูปลาร้า-.jpg" class="w-full h-full object-cover">
        </div>
    
        <div class="bg-gray-300">
            <img src="imgallinweb/ตำป่า-.jpg" class="w-full h-full object-cover">
        </div>

        <div class="bg-gray-300">
            <img src="imgallinweb/ตำลาวแคปหมู-.jpg" class="w-full h-full object-cover">
        </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="lg:col-span-2 space-y-4">
        
        <div class="bg-white p-5 rounded-lg shadow-sm">
    <div class="flex justify-between items-start">
        <div>
            <h1 class="text-2xl font-bold text-gray-800">ร้านขนมจีนเส้นสดแม่ลำพึง</h1>
            <div class="mt-3 flex flex-wrap gap-2">
                <a href="../../../index.html" class="flex items-center gap-2 bg-gray-100 text-gray-700 px-4 py-1.5 rounded text-sm font-medium hover:bg-gray-200 transition">
                    <i class="fas fa-home"></i> กลับหน้าหลัก
                </a>
                
                <button onclick="toggleModal()" style="background-color: #ff7043;" class="text-white px-4 py-1.5 rounded text-sm font-medium hover:opacity-90 transition">
                    <i class="fas fa-pen-square"></i> เขียนรีวิว
                </button>
                
                <button id="shareButton" onclick="copyPageLink()" class="border border-gray-300 text-gray-600 px-4 py-1.5 rounded text-sm hover:bg-gray-50 transition flex items-center gap-2">
                    <i class="fas fa-share"></i> <span id="shareText">แชร์</span>
                </button>

                <a href="imgallinweb/Imgallinweb3.html" class="bg-blue-600 text-white px-4 py-1.5 rounded text-sm font-medium hover:bg-blue-700 transition flex items-center gap-2">
                    <i class="fas fa-images"></i> ดูรูปทั้งหมด
                </a>
            </div>
        </div>
    </div>
</div>

        <div class="bg-blue-50 border border-blue-100 p-4 rounded-lg flex items-center gap-4">
           <div class="w-12 h-12 bg-blue-200 rounded-full flex items-center justify-center text-blue-600"><i class="fas fa-utensils text-xl"></i></div>
           <div><p class="text-sm text-blue-600 font-bold">หมวดหมู่ร้านอาหารตามสั่ง</p></div>
        </div><div class="bg-white p-5 rounded-lg shadow-sm">
    <div class="flex items-center gap-2 mb-4 border-b pb-2">
        <i class="fas fa-thumbs-up text-orange-500 text-xl"></i>
        <h3 class="font-bold text-lg">เมนูเด็ดต้องลอง!</h3>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="border rounded-xl overflow-hidden hover:shadow-md transition group">
            <div class="h-32 overflow-hidden cursor-pointer" onclick="openImageModal('imgallinweb/ตำปูปลาร้า-.jpg')">
                <img src="imgallinweb/ตำปูปลาร้า-.jpg" class="w-full h-full object-cover group-hover:scale-110 transition duration-300">
            </div>
            <div class="p-3">
                <h4 class="font-bold text-gray-800 text-sm">ตำปูปลาร้า</h4>
                <p class="text-xs text-gray-500 mt-1">ตำปูปลาร้า รสชาติเผ็ดจัด</p>
                <div class="mt-2 text-orange-600 font-bold text-sm">฿75</div>
            </div>
        </div>

        <div class="border rounded-xl overflow-hidden hover:shadow-md transition group">
            <div class="h-32 overflow-hidden cursor-pointer" onclick="openImageModal('imgallinweb/ตำป่า-.jpg')">
                <img src="imgallinweb/ตำป่า-.jpg" class="w-full h-full object-cover group-hover:scale-110 transition duration-300">
            </div>
            <div class="p-3">
                <h4 class="font-bold text-gray-800 text-sm">ตำป่า</h4>
                <p class="text-xs text-gray-500 mt-1">ตำป่า รสชาติเผ็ดจัด</p>
                <div class="mt-2 text-orange-600 font-bold text-sm">฿85</div>
            </div>
        </div>

        <div class="border rounded-xl overflow-hidden hover:shadow-md transition group">
            <div class="h-32 overflow-hidden cursor-pointer" onclick="openImageModal('imgallinweb/ตำลาวแคปหมู-.jpg')">
                <img src="imgallinweb/ตำลาวแคปหมู-.jpg" class="w-full h-full object-cover group-hover:scale-110 transition duration-300">
            </div>
            <div class="p-3">
                <h4 class="font-bold text-gray-800 text-sm">ตำลาวแคปหมู</h4>
                <p class="text-xs text-gray-500 mt-1">ตำลาวแคปหมู รสชาติเผ็ดจัด</p>
                <div class="mt-2 text-orange-600 font-bold text-sm">฿60</div>
            </div>
        </div>
    </div>
</div>

<div id="imageModal" class="fixed inset-0 bg-black bg-opacity-90 hidden flex items-center justify-center p-4" style="z-index: 10000;" onclick="closeImageModal()">
    <div class="relative max-w-4xl w-full flex justify-center">
        <img id="fullImage" src="" class="max-h-[90vh] max-w-full rounded-lg shadow-2xl animate-scale-up">
        <button class="absolute top-[-40px] right-0 text-white text-3xl">&times;</button>
    </div>
</div>

        <div class="bg-white p-5 rounded-lg shadow-sm">
            <h3 class="font-bold text-lg mb-4 border-b pb-2">รีวิวจากลูกค้า</h3>
            <div id="reviewContainer" class="space-y-4 min-h-[100px]">
                <p class="text-gray-400 text-sm text-center py-4" id="emptyMsg">ยังไม่มีรีวิว เขียนเป็นคนแรกเลย!</p>
            </div>
        </div>
    </div>

    <!-- เปลี่ยนใส่ที่อยู่ให้ตรงเนื้อหาของร้านในหน้าเพจนี้ -->
    <div class="hidden lg:block">
        <div class="bg-white rounded-lg shadow-sm overflow-hidden sticky top-20">
            <div class="h-32 bg-gray-200 relative">
                <a href="https://maps.app.goo.gl/XpwTZ2FrWsbvuaNs8">
                <div class="absolute inset-0 flex items-center justify-center"><i class="fas fa-map-marker-alt text-red-500 text-3xl"></i></div>
                </a>
            </div>
            <div class="p-4">
                <a href="https://maps.app.goo.gl/YHtHdSGeL4hikW7r8">
                <h4 class="font-bold text-sm mb-2">ที่อยู่</h4>
                <p class="text-xs text-gray-600 mb-3">ปากทางเข้าตลาดโดมสีขาว หลังร้านขายน้ำหวาน ติดกับสเต็ก49, ถนน โพศรี บ้านเลื่อม เมืองอุดรธานี อุดรธานี อุดรธานี (ด้านหน้าตลาดในโดมสีขาว ปากทางเข้า ติดกับร้านสเต็ก49)</p>
                <div class="border-t pt-3 text-xs text-gray-500">
                    <h4 class="font-bold text-black mb-1">เวลาเปิด-ปิด</h4>
                    <p>	14:30 - 22:00</p>
                </div>
                </a>
            </div>
        </div>
    </div>
</div>

    <div id="reviewModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center" style="z-index: 9999;">
    <div class="bg-white rounded-lg p-6 w-full max-w-lg shadow-xl mx-4 relative">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold">เขียนรีวิว</h3>
            <button onclick="toggleModal()" class="text-gray-400 hover:text-gray-600 p-2"><i class="fas fa-times"></i></button>
        </div>
        
        <div class="grid grid-cols-2 gap-4 mb-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">ชื่อของคุณ</label>
                <input type="text" id="newName" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none" placeholder="ระบุชื่อ">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">อายุ (ปี)</label>
                <input type="number" id="newAge" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none" placeholder="ระบุอายุ">
            </div>
        </div>

        <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">ความพึงพอใจ</label>
            <select id="newRating" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                <option value="5">5 ดาว - ยอดเยี่ยม</option>
                <option value="4">4 ดาว - ดีมาก</option>
                <option value="3">3 ดาว - ปานกลาง</option>
                <option value="2">2 ดาว - พอใช้</option>
                <option value="1">1 ดาว - ควรปรับปรุง</option>
            </select>
        </div>

        <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">รีวิวของคุณ</label>
            <textarea id="newComment" rows="4" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none" placeholder="เล่าประสบการณ์ รสชาติอาหาร บรรยากาศ..."></textarea>
        </div>

        <div class="flex justify-end gap-2">
            <button onclick="toggleModal()" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-md">ยกเลิก</button>
            <button onclick="submitReview()" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 font-medium">โพสต์รีวิว</button>
        </div>
    </div>
</div>
    

    <script>
    // 1. โหลดรีวิวจาก Google Sheets ทันทีที่เปิดหน้าเว็บ
    document.addEventListener('DOMContentLoaded', function() {
        loadReviews();
    });

    function toggleModal() {
        const modal = document.getElementById('reviewModal');
        modal.classList.toggle('hidden');
    }

    async function submitReview() {
        const name = document.getElementById('newName').value || "ผู้ใช้ทั่วไป";
        const age = document.getElementById('newAge').value || "-";
        const rating = document.getElementById('newRating').value;
        const comment = document.getElementById('newComment').value;

        if (comment.trim() === "") {
            alert("กรุณาเขียนรีวิวสักหน่อยนะครับนะมันูน");
            return;
        }

        const reviewData = {
            name: name,
            age: age,
            rating: rating,
            comment: comment
        };

        const scriptURL = 'https://script.google.com/macros/s/AKfycbwoXgdXCXZyT7Qs8Z6LU5CQxT5ixe_8XOJi9rCIIF8IKNzbXVejUBPEZB2pVeLMU5f3/exec';

        try {
            // ส่งข้อมูลไปที่ Google Sheets
            fetch(scriptURL, {
                method: 'POST',
                body: JSON.stringify(reviewData)
            });

            // แสดงผลที่หน้าเว็บทันทีเพื่อให้ผู้ใช้เห็น
            renderReview({ ...reviewData, time: "เมื่อสักครู่" });
            
            // ล้างค่าและปิด Modal
            document.getElementById('newComment').value = "";
            document.getElementById('newName').value = "";
            document.getElementById('newAge').value = "";
            toggleModal();
            
            alert("ขอบคุณสำหรับรีวิวครับ! ข้อมูลถูกบันทึกลงระบบแล้วนะมันูน");
        } catch (error) {
            console.error('Error!', error.message);
            alert("เกิดข้อผิดพลาดในการส่งข้อมูลครับ");
        }
    }

    async function loadReviews() {
        const scriptURL = 'https://script.google.com/macros/s/AKfycbwoXgdXCXZyT7Qs8Z6LU5CQxT5ixe_8XOJi9rCIIF8IKNzbXVejUBPEZB2pVeLMU5f3/exec'; 
        const container = document.getElementById('reviewContainer');

        try {
            const response = await fetch(scriptURL);
            const reviews = await response.json();

            if (reviews && reviews.length > 0) {
                container.innerHTML = ''; // ล้างข้อความ "ยังไม่มีรีวิว"
                reviews.forEach(review => {
                    const formattedTime = new Date(review.time).toLocaleString('th-TH');
                    renderReview({
                        name: review.name,
                        age: review.age,
                        rating: parseInt(review.rating),
                        comment: review.comment,
                        time: formattedTime === 'Invalid Date' ? review.time : formattedTime
                    });
                });
            }
        } catch (error) {
            console.error('Error loading reviews:', error);
        }
    }

    // แยกฟังก์ชันแสดงผลออกมาให้ชัดเจน จะได้ไม่ทับกันนะมันูน
    function renderReview(data) {
        const container = document.getElementById('reviewContainer');
        const emptyMsg = document.getElementById('emptyMsg');
        if (emptyMsg) emptyMsg.style.display = 'none';

        const reviewHTML = `
            <div class="bg-white p-5 rounded-lg shadow-sm border border-gray-100 mb-4 animate-fade-in-down">
                <div class="flex items-start gap-4">
                    <div class="flex-shrink-0">
                        <img src="https://ui-avatars.com/api/?name=${data.name}&background=random" class="w-12 h-12 rounded-full border">
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="font-bold text-gray-900 text-base">${data.name} <span class="text-xs font-normal text-gray-400">(อายุ: ${data.age})</span></h4>
                            </div>
                            <span class="text-xs text-gray-400">${data.time}</span>
                        </div>
                        <div class="flex items-center gap-2 mt-1 mb-3">
                            <span class="bg-orange-500 text-white text-xs font-bold px-1.5 py-0.5 rounded">${data.rating}.0</span>
                            <div class="text-yellow-400 text-xs">
                                ${'<i class="fas fa-star"></i>'.repeat(data.rating)}
                                ${'<i class="far fa-star"></i>'.repeat(5 - data.rating)}
                            </div>
                        </div>
                        <p class="text-sm text-gray-600 leading-relaxed">${data.comment}</p>
                    </div>
                </div>
            </div>
        `;
        container.insertAdjacentHTML('afterbegin', reviewHTML); // เอาอันใหม่ไว้บนสุด
    }

    // ฟังก์ชันรูปภาพและแชร์
    function openImageModal(src) {
        const modal = document.getElementById('imageModal');
        const fullImg = document.getElementById('fullImage');
        fullImg.src = src;
        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }

    function closeImageModal() {
        document.getElementById('imageModal').classList.add('hidden');
        document.body.style.overflow = 'auto';
    }

    function copyPageLink() {
        navigator.clipboard.writeText(window.location.href).then(() => {
            const shareText = document.getElementById('shareText');
            shareText.innerText = "คัดลอกแล้ว!";
            setTimeout(() => { shareText.innerText = "แชร์"; }, 2000);
        });
    }
</script>
    <footer class="bg-white mt-8 py-8 border-t">
        <div class="container mx-auto px-4 text-center">
            <div class="text-2xl font-bold italic tracking-tighter mb-4"><span class="wongnai-blue">แนะนำ</span><span class="wongnai-orange">ใกล้ฉัน</span></div>
            <p class="text-xs text-gray-400">© 2024 แนะนำใกล้ฉัน Media Co., Ltd. All rights reserved.</p>
        </div>
    </footer>
</body>
</html>